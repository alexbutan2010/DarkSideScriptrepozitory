-- Encoded Scripte starts here
cGNhbGwoZnVuY3Rpb24oKQ0KICAgIGlmIG5vdCBnYW1lWydMb2FkZWQnXSB0aGVuIGdhbWVbJ0xvYWRlZCddOldhaXQoKSBlbmQ7IHJlcGVhdCB3YWl0KC4wNikgdW50aWwgZ2FtZTpHZXRTZXJ2aWNlKCdQbGF5ZXJzJykuTG9jYWxQbGF5ZXIgfj0gbmlsDQogICAgbG9jYWwgWW91ckxhbmcgPSAiZW4iIC0tIExhbmd1YWdlIGNvZGUgdGhhdCB0aGUgbWVzc2FnZXMgYXJlIGdvaW5nIHRvIGJlIHRyYW5zbGF0ZWQgdG8NCiAgICANCiAgICBsb2NhbCBnb29nbGV2ID0gaXNmaWxlJ2dvb2dsZXYudHh0JyBhbmQgcmVhZGZpbGUnZ29vZ2xldi50eHQnIG9yICcnDQogICAgDQogICAgZnVuY3Rpb24gZ29vZ2xlQ29uc2VudChCb2R5KSAtLSBCZWNhdXNlIGdvb2dsZSByZWFsbHkgc2FpZDogIkZ1Y2sgeW91LiINCiAgICAgICAgbG9jYWwgYXJncyA9IHt9DQogICAgDQogICAgICAgIGZvciBtYXRjaCBpbiBCb2R5OmdtYXRjaCgnPGlucHV0IHR5cGU9ImhpZGRlbiIgbmFtZT0iLi0iIHZhbHVlPSIuLSI+JykgZG8NCiAgICAgICAgICAgIGxvY2FsIGssdiA9IG1hdGNoOm1hdGNoKCc8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSIoLi0pIiB2YWx1ZT0iKC4tKSI+JykNCiAgICAgICAgICAgIGFyZ3Nba10gPSB2DQogICAgICAgIGVuZA0KICAgICAgICBnb29nbGV2ID0gYXJncy52DQogICAgICAgIHdyaXRlZmlsZSgnZ29vZ2xldi50eHQnLCBhcmdzLnYpDQogICAgZW5kDQogICAgDQogICAgbG9jYWwgZnVuY3Rpb24gZ290KHVybCwgTWV0aG9kLCBCb2R5KSAtLSBCYXNpYyB2ZXJzaW9uIG9mIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL2dvdCB1c2luZyBzeW5hcHNlJ3MgcmVxdWVzdCBBUEkgZm9yIGdvb2dsZSB3ZWJzaXRlcw0KICAgICAgICBNZXRob2QgPSBNZXRob2Qgb3IgIkdFVCINCiAgICAgICAgDQogICAgICAgIGxvY2FsIHJlcyA9IHJlcXVlc3Qoew0KICAgICAgICAgICAgVXJsID0gdXJsLA0KICAgICAgICAgICAgTWV0aG9kID0gTWV0aG9kLA0KICAgICAgICAgICAgSGVhZGVycyA9IHtjb29raWU9IkNPTlNFTlQ9WUVTKyIuLmdvb2dsZXZ9LA0KICAgICAgICAgICAgQm9keSA9IEJvZHkNCiAgICAgICAgfSkNCiAgICAgICAgDQogICAgICAgIGlmIHJlcy5Cb2R5Om1hdGNoKCdodHRwczovL2NvbnNlbnQuZ29vZ2xlLmNvbS9zJykgdGhlbg0KICAgICAgICAgICAgcHJpbnQoJ2NvbnNlbnQnKQ0KICAgICAgICAgICAgZ29vZ2xlQ29uc2VudChyZXMuQm9keSkNCiAgICAgICAgICAgIHJlcyA9IHJlcXVlc3Qoew0KICAgICAgICAgICAgICAgIFVybCA9IHVybCwNCiAgICAgICAgICAgICAgICBNZXRob2QgPSAiR0VUIiwNCiAgICAgICAgICAgICAgICBIZWFkZXJzID0ge2Nvb2tpZT0iQ09OU0VOVD1ZRVMrIi4uZ29vZ2xldn0NCiAgICAgICAgICAgIH0pDQogICAgICAgIGVuZA0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJlcw0KICAgIGVuZA0KICAgIA0KICAgIGxvY2FsIGxhbmd1YWdlcyA9IHsNCiAgICAgICAgYXV0byA9ICJBdXRvbWF0aWMiLA0KICAgICAgICBhZiA9ICJBZnJpa2FhbnMiLA0KICAgICAgICBzcSA9ICJBbGJhbmlhbiIsDQogICAgICAgIGFtID0gIkFtaGFyaWMiLA0KICAgICAgICBhciA9ICJBcmFiaWMiLA0KICAgICAgICBoeSA9ICJBcm1lbmlhbiIsDQogICAgICAgIGF6ID0gIkF6ZXJiYWlqYW5pIiwNCiAgICAgICAgZXUgPSAiQmFzcXVlIiwNCiAgICAgICAgYmUgPSAiQmVsYXJ1c2lhbiIsDQogICAgICAgIGJuID0gIkJlbmdhbGkiLA0KICAgICAgICBicyA9ICJCb3NuaWFuIiwNCiAgICAgICAgYmcgPSAiQnVsZ2FyaWFuIiwNCiAgICAgICAgY2EgPSAiQ2F0YWxhbiIsDQogICAgICAgIGNlYiA9ICJDZWJ1YW5vIiwNCiAgICAgICAgbnkgPSAiQ2hpY2hld2EiLA0KICAgICAgICBbJ3poLWNuJ10gPSAiQ2hpbmVzZSBTaW1wbGlmaWVkIiwNCiAgICAgICAgWyd6aC10dyddID0gIkNoaW5lc2UgVHJhZGl0aW9uYWwiLA0KICAgICAgICBjbyA9ICJDb3JzaWNhbiIsDQogICAgICAgIGhyID0gIkNyb2F0aWFuIiwNCiAgICAgICAgY3MgPSAiQ3plY2giLA0KICAgICAgICBkYSA9ICJEYW5pc2giLA0KICAgICAgICBubCA9ICJEdXRjaCIsDQogICAgICAgIGVuID0gIkVuZ2xpc2giLA0KICAgICAgICBlbyA9ICJFc3BlcmFudG8iLA0KICAgICAgICBldCA9ICJFc3RvbmlhbiIsDQogICAgICAgIHRsID0gIkZpbGlwaW5vIiwNCiAgICAgICAgZmkgPSAiRmlubmlzaCIsDQogICAgICAgIGZyID0gIkZyZW5jaCIsDQogICAgICAgIGZ5ID0gIkZyaXNpYW4iLA0KICAgICAgICBnbCA9ICJHYWxpY2lhbiIsDQogICAgICAgIGthID0gIkdlb3JnaWFuIiwNCiAgICAgICAgZGUgPSAiR2VybWFuIiwNCiAgICAgICAgZWwgPSAiR3JlZWsiLA0KICAgICAgICBndSA9ICJHdWphcmF0aSIsDQogICAgICAgIGh0ID0gIkhhaXRpYW4gQ3Jlb2xlIiwNCiAgICAgICAgaGEgPSAiSGF1c2EiLA0KICAgICAgICBoYXcgPSAiSGF3YWlpYW4iLA0KICAgICAgICBpdyA9ICJIZWJyZXciLA0KICAgICAgICBoaSA9ICJIaW5kaSIsDQogICAgICAgIGhtbiA9ICJIbW9uZyIsDQogICAgICAgIGh1ID0gIkh1bmdhcmlhbiIsDQogICAgICAgIGlzID0gIkljZWxhbmRpYyIsDQogICAgICAgIGlnID0gIklnYm8iLA0KICAgICAgICBpZCA9ICJJbmRvbmVzaWFuIiwNCiAgICAgICAgZ2EgPSAiSXJpc2giLA0KICAgICAgICBpdCA9ICJJdGFsaWFuIiwNCiAgICAgICAgamEgPSAiSmFwYW5lc2UiLA0KICAgICAgICBqdyA9ICJKYXZhbmVzZSIsDQogICAgICAgIGtuID0gIkthbm5hZGEiLA0KICAgICAgICBrayA9ICJLYXpha2giLA0KICAgICAgICBrbSA9ICJLaG1lciIsDQogICAgICAgIGtvID0gIktvcmVhbiIsDQogICAgICAgIGt1ID0gIkt1cmRpc2ggKEt1cm1hbmppKSIsDQogICAgICAgIGt5ID0gIkt5cmd5eiIsDQogICAgICAgIGxvID0gIkxhbyIsDQogICAgICAgIGxhID0gIkxhdGluIiwNCiAgICAgICAgbHYgPSAiTGF0dmlhbiIsDQogICAgICAgIGx0ID0gIkxpdGh1YW5pYW4iLA0KICAgICAgICBsYiA9ICJMdXhlbWJvdXJnaXNoIiwNCiAgICAgICAgbWsgPSAiTWFjZWRvbmlhbiIsDQogICAgICAgIG1nID0gIk1hbGFnYXN5IiwNCiAgICAgICAgbXMgPSAiTWFsYXkiLA0KICAgICAgICBtbCA9ICJNYWxheWFsYW0iLA0KICAgICAgICBtdCA9ICJNYWx0ZXNlIiwNCiAgICAgICAgbWkgPSAiTWFvcmkiLA0KICAgICAgICBtciA9ICJNYXJhdGhpIiwNCiAgICAgICAgbW4gPSAiTW9uZ29saWFuIiwNCiAgICAgICAgbXkgPSAiTXlhbm1hciAoQnVybWVzZSkiLA0KICAgICAgICBuZSA9ICJOZXBhbGkiLA0KICAgICAgICBubyA9ICJOb3J3ZWdpYW4iLA0KICAgICAgICBwcyA9ICJQYXNodG8iLA0KICAgICAgICBmYSA9ICJQZXJzaWFuIiwNCiAgICAgICAgcGwgPSAiUG9saXNoIiwNCiAgICAgICAgcHQgPSAiUG9ydHVndWVzZSIsDQogICAgICAgIHBhID0gIlB1bmphYmkiLA0KICAgICAgICBybyA9ICJSb21hbmlhbiIsDQogICAgICAgIHJ1ID0gIlJ1c3NpYW4iLA0KICAgICAgICBzbSA9ICJTYW1vYW4iLA0KICAgICAgICBnZCA9ICJTY290cyBHYWVsaWMiLA0KICAgICAgICBzciA9ICJTZXJiaWFuIiwNCiAgICAgICAgc3QgPSAiU2Vzb3RobyIsDQogICAgICAgIHNuID0gIlNob25hIiwNCiAgICAgICAgc2QgPSAiU2luZGhpIiwNCiAgICAgICAgc2kgPSAiU2luaGFsYSIsDQogICAgICAgIHNrID0gIlNsb3ZhayIsDQogICAgICAgIHNsID0gIlNsb3ZlbmlhbiIsDQogICAgICAgIHNvID0gIlNvbWFsaSIsDQogICAgICAgIGVzID0gIlNwYW5pc2giLA0KICAgICAgICBzdSA9ICJTdW5kYW5lc2UiLA0KICAgICAgICBzdyA9ICJTd2FoaWxpIiwNCiAgICAgICAgc3YgPSAiU3dlZGlzaCIsDQogICAgICAgIHRnID0gIlRhamlrIiwNCiAgICAgICAgdGEgPSAiVGFtaWwiLA0KICAgICAgICB0ZSA9ICJUZWx1Z3UiLA0KICAgICAgICB0aCA9ICJUaGFpIiwNCiAgICAgICAgdHIgPSAiVHVya2lzaCIsDQogICAgICAgIHVrID0gIlVrcmFpbmlhbiIsDQogICAgICAgIHVyID0gIlVyZHUiLA0KICAgICAgICB1eiA9ICJVemJlayIsDQogICAgICAgIHZpID0gIlZpZXRuYW1lc2UiLA0KICAgICAgICBjeSA9ICJXZWxzaCIsDQogICAgICAgIHhoID0gIlhob3NhIiwNCiAgICAgICAgeWkgPSAiWWlkZGlzaCIsDQogICAgICAgIHlvID0gIllvcnViYSIsDQogICAgICAgIHp1ID0gIlp1bHUiDQogICAgfTsNCiAgICANCiAgICBmdW5jdGlvbiBmaW5kKGxhbmcpDQogICAgICAgIGZvciBpLHYgaW4gcGFpcnMobGFuZ3VhZ2VzKSBkbw0KICAgICAgICAgICAgaWYgaSA9PSBsYW5nIG9yIHYgPT0gbGFuZyB0aGVuDQogICAgICAgICAgICAgICAgcmV0dXJuIGkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICANCiAgICBmdW5jdGlvbiBpc1N1cHBvcnRlZChsYW5nKQ0KICAgICAgICBsb2NhbCBrZXkgPSBmaW5kKGxhbmcpDQogICAgICAgIHJldHVybiBrZXkgYW5kIHRydWUgb3IgZmFsc2UgDQogICAgZW5kDQogICAgDQogICAgZnVuY3Rpb24gZ2V0SVNPQ29kZShsYW5nKQ0KICAgICAgICBsb2NhbCBrZXkgPSBmaW5kKGxhbmcpDQogICAgICAgIHJldHVybiBrZXkNCiAgICBlbmQNCiAgICANCiAgICBmdW5jdGlvbiBzdHJpbmdpZnlRdWVyeShkYXRhRmllbGRzKQ0KICAgICAgICBsb2NhbCBkYXRhID0gIiINCiAgICAgICAgZm9yIGssIHYgaW4gcGFpcnMoZGF0YUZpZWxkcykgZG8NCiAgICAgICAgICAgIGlmIHR5cGUodikgPT0gInRhYmxlIiB0aGVuDQogICAgICAgICAgICAgICAgZm9yIF8sdiBpbiBwYWlycyh2KSBkbw0KICAgICAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSAuLiAoIiYlcz0lcyIpOmZvcm1hdCgNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuSHR0cFNlcnZpY2U6VXJsRW5jb2RlKGspLA0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5IdHRwU2VydmljZTpVcmxFbmNvZGUodikNCiAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhIC4uICgiJiVzPSVzIik6Zm9ybWF0KA0KICAgICAgICAgICAgICAgICAgICBnYW1lLkh0dHBTZXJ2aWNlOlVybEVuY29kZShrKSwNCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5IdHRwU2VydmljZTpVcmxFbmNvZGUodikNCiAgICAgICAgICAgICAgICApDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIGRhdGEgPSBkYXRhOnN1YigyKQ0KICAgICAgICByZXR1cm4gZGF0YQ0KICAgIGVuZA0KICAgIA0KICAgIGxvY2FsIHJlcWlkID0gbWF0aC5yYW5kb20oMTAwMCw5OTk5KQ0KICAgIGxvY2FsIHJwY2lkc1RyYW5zbGF0ZSA9ICJNa0VXQmMiDQogICAgbG9jYWwgcm9vdFVSTCA9ICJodHRwczovL3RyYW5zbGF0ZS5nb29nbGUuY29tLyINCiAgICBsb2NhbCBleGVjdXRlVVJMID0gImh0dHBzOi8vdHJhbnNsYXRlLmdvb2dsZS5jb20vXy9UcmFuc2xhdGVXZWJzZXJ2ZXJVaS9kYXRhL2JhdGNoZXhlY3V0ZSINCiAgICBsb2NhbCBmc2lkLCBibA0KICAgIA0KICAgIGRvIC0tIGluaXQNCiAgICAgICAgcHJpbnQoJ2luaXRpYWxpemUnKQ0KICAgICAgICBsb2NhbCBJbml0aWFsUmVxID0gZ290KHJvb3RVUkwpDQogICAgICAgIGZzaWQgPSBJbml0aWFsUmVxLkJvZHk6bWF0Y2goJyJGZHJGSmUiOiIoLi0pIicpDQogICAgICAgIGJsID0gSW5pdGlhbFJlcS5Cb2R5Om1hdGNoKCciY2ZiMmgiOiIoLi0pIicpDQogICAgZW5kDQogICAgDQogICAgbG9jYWwgSHR0cFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIikNCiAgICBmdW5jdGlvbiBqc29uRShvKQ0KICAgICAgICByZXR1cm4gSHR0cFNlcnZpY2U6SlNPTkVuY29kZShvKQ0KICAgIGVuZA0KICAgIGZ1bmN0aW9uIGpzb25EKG8pDQogICAgICAgIHJldHVybiBIdHRwU2VydmljZTpKU09ORGVjb2RlKG8pDQogICAgZW5kDQogICAgDQogICAgZnVuY3Rpb24gdHJhbnNsYXRlKHN0ciwgdG8sIGZyb20pDQogICAgICAgIHJlcWlkID0gcmVxaWQgKyAxMDAwMA0KICAgICAgICBmcm9tID0gZnJvbSBhbmQgZ2V0SVNPQ29kZShmcm9tKSBvciAnYXV0bycNCiAgICAgICAgdG8gPSB0byBhbmQgZ2V0SVNPQ29kZSh0bykgb3IgJ2VuJw0KICAgIA0KICAgICAgICBsb2NhbCBkYXRhID0ge3tzdHIsIGZyb20sIHRvLCB0cnVlfSwge25pbH19DQogICAgDQogICAgICAgIGxvY2FsIGZyZXEgPSB7DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBycGNpZHNUcmFuc2xhdGUsIA0KICAgICAgICAgICAgICAgICAgICBqc29uRShkYXRhKSwNCiAgICAgICAgICAgICAgICAgICAgbmlsLA0KICAgICAgICAgICAgICAgICAgICAiZ2VuZXJpYyINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgbG9jYWwgdXJsID0gZXhlY3V0ZVVSTC4uJz8nLi5zdHJpbmdpZnlRdWVyeXtycGNpZHMgPSBycGNpZHNUcmFuc2xhdGUsIFsnZi5zaWQnXSA9IGZzaWQsIGJsID0gYmwsIGhsPSJlbiIsIF9yZXFpZCA9IHJlcWlkLTEwMDAwLCBydCA9ICdjJ30NCiAgICAgICAgbG9jYWwgYm9keSA9IHN0cmluZ2lmeVF1ZXJ5e1snZi5yZXEnXSA9IGpzb25FKGZyZXEpfQ0KICAgICAgICANCiAgICAgICAgbG9jYWwgcmVxID0gZ290KHVybCwgIlBPU1QiLCBib2R5KQ0KICAgICAgICANCiAgICAgICAgbG9jYWwgYm9keSA9IGpzb25EKHJlcS5Cb2R5Om1hdGNoJyVbLi0lXVxuJykNCiAgICAgICAgbG9jYWwgdHJhbnNsYXRpb25EYXRhID0ganNvbkQoYm9keVsxXVszXSkNCiAgICAgICAgbG9jYWwgcmVzdWx0ID0gew0KICAgICAgICAgICAgdGV4dCA9ICIiLA0KICAgICAgICAgICAgZnJvbSA9IHsNCiAgICAgICAgICAgICAgICBsYW5ndWFnZSA9ICIiLA0KICAgICAgICAgICAgICAgIHRleHQgPSAiIg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHJhdyA9ICIiDQogICAgICAgIH0NCiAgICAgICAgcmVzdWx0LnJhdyA9IHRyYW5zbGF0aW9uRGF0YQ0KICAgICAgICByZXN1bHQudGV4dCA9IHRyYW5zbGF0aW9uRGF0YVsyXVsxXVsxXVs2XVsxXVsxXQ0KICAgICAgICANCiAgICAgICAgcmVzdWx0LmZyb20ubGFuZ3VhZ2UgPSB0cmFuc2xhdGlvbkRhdGFbM10NCiAgICAgICAgcmVzdWx0LmZyb20udGV4dCA9IHRyYW5zbGF0aW9uRGF0YVsyXVs1XVsxXQ0KICAgIA0KICAgICAgICByZXR1cm4gcmVzdWx0DQogICAgZW5kDQogICAgDQogICAgbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpDQogICAgbG9jYWwgTFAgPSBQbGF5ZXJzLkxvY2FsUGxheWVyDQogICAgbG9jYWwgU3RhcnRlckd1aSA9IGdhbWU6R2V0U2VydmljZSgnU3RhcnRlckd1aScpDQogICAgZm9yIGk9MSwgMTUgZG8NCiAgICAgICAgbG9jYWwgciA9IHBjYWxsKFN0YXJ0ZXJHdWlbIlNldENvcmUiXSkNCiAgICAgICAgaWYgciB0aGVuIGJyZWFrIGVuZA0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoJ1J1blNlcnZpY2UnKS5SZW5kZXJTdGVwcGVkOndhaXQoKQ0KICAgIGVuZA0KICAgIHdhaXQoKQ0KICAgIA0KICAgIGxvY2FsIHByb3BlcnRpZXMgPSB7DQogICAgICAgIENvbG9yID0gQ29sb3IzLm5ldygxLDEsMCk7DQogICAgICAgIEZvbnQgPSBFbnVtLkZvbnQuU291cmNlU2Fuc0l0YWxpYzsNCiAgICAgICAgVGV4dFNpemUgPSAxNjsNCiAgICB9DQogICAgDQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsDQogICAgICAgIHsNCiAgICAgICAgICAgIFRpdGxlID0gIkNoYXQgVHJhbnNsYXRvciIsDQogICAgICAgICAgICBUZXh0ID0gIlBvcnRlZCB0byBHb29nbGUgVHJhbnNsYXRlIiwNCiAgICAgICAgICAgIER1cmF0aW9uID0gMw0KICAgICAgICB9DQogICAgKQ0KICAgICAgICAgICAgICAgICAgICAgIA0KICAgIHByb3BlcnRpZXMuVGV4dCA9ICJbVFJdIFRvIHNlbmQgbWVzc2FnZXMgaW4gYSBsYW5ndWFnZSwgc2F5ID4gZm9sbG93ZWQgYnkgdGhlIHRhcmdldCBsYW5ndWFnZS9sYW5ndWFnZSBjb2RlLCBlLmcuOiA+cnUgb3IgPnJ1c3NpYW4uIFRvIGRpc2FibGUgKGdvIGJhY2sgdG8gb3JpZ2luYWwgbGFuZ3VhZ2UpLCBzYXkgPmQuIg0KICAgIFN0YXJ0ZXJHdWk6U2V0Q29yZSgiQ2hhdE1ha2VTeXN0ZW1NZXNzYWdlIiwgcHJvcGVydGllcykNCiAgICANCiAgICBmdW5jdGlvbiB0cmFuc2xhdGVGcm9tKG1lc3NhZ2UpDQogICAgICAgIGxvY2FsIHRyYW5zbGF0aW9uID0gdHJhbnNsYXRlKG1lc3NhZ2UsIFlvdXJMYW5nKQ0KICAgIA0KICAgICAgICBsb2NhbCB0ZXh0DQogICAgICAgIGlmIHRyYW5zbGF0aW9uLmZyb20ubGFuZ3VhZ2Ugfj0gWW91ckxhbmcgdGhlbiANCiAgICAgICAgICAgIHRleHQgPSB0cmFuc2xhdGlvbi50ZXh0DQogICAgICAgIGVuZA0KICAgIA0KICAgICAgICByZXR1cm4ge3RleHQsIHRyYW5zbGF0aW9uLmZyb20ubGFuZ3VhZ2V9DQogICAgZW5kDQogICAgDQogICAgZnVuY3Rpb24gZ2V0KHBsciwgbXNnKQ0KICAgICAgICBsb2NhbCB0YWIgPSB0cmFuc2xhdGVGcm9tKG1zZykNCiAgICAgICAgbG9jYWwgdHJhbnNsYXRpb24gPSB0YWJbMV0NCiAgICAgICAgaWYgdHJhbnNsYXRpb24gdGhlbg0KICAgICAgICAgICAgcHJvcGVydGllcy5UZXh0ID0gIigiLi50YWJbMl06dXBwZXIoKS4uIikgIi4uIlsiLi4gcGxyLk5hbWUgLi4iXTogIi4udHJhbnNsYXRpb24NCiAgICAgICAgICAgIFN0YXJ0ZXJHdWk6U2V0Q29yZSgiQ2hhdE1ha2VTeXN0ZW1NZXNzYWdlIiwgcHJvcGVydGllcykNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgDQogICAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5EZWZhdWx0Q2hhdFN5c3RlbUNoYXRFdmVudHMuT25NZXNzYWdlRG9uZUZpbHRlcmluZy5PbkNsaWVudEV2ZW50OkNvbm5lY3QoZnVuY3Rpb24obWVzc2FnZURhdGEpIA0KICAgICAgICBnZXQoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIilbbWVzc2FnZURhdGEuRnJvbVNwZWFrZXJdLG1lc3NhZ2VEYXRhLk1lc3NhZ2UpDQogICAgICAgIHByaW50KGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpW21lc3NhZ2VEYXRhLkZyb21TcGVha2VyXSx0b3N0cmluZyhtZXNzYWdlRGF0YS5NZXNzYWdlKSkNCiAgICBlbmQpDQogICAgDQogICAgbG9jYWwgc2VuZEVuYWJsZWQgPSBmYWxzZQ0KICAgIGxvY2FsIHRhcmdldCA9ICIiDQogICAgDQogICAgZnVuY3Rpb24gdHJhbnNsYXRlVG8obWVzc2FnZSwgdGFyZ2V0KQ0KICAgICAgICB0YXJnZXQgPSB0YXJnZXQ6bG93ZXIoKSANCiAgICAgICAgbG9jYWwgdHJhbnNsYXRpb24gPSB0cmFuc2xhdGUobWVzc2FnZSwgdGFyZ2V0LCAiYXV0byIpDQogICAgDQogICAgICAgIHJldHVybiB0cmFuc2xhdGlvbi50ZXh0DQogICAgZW5kDQogICAgDQogICAgZnVuY3Rpb24gZGlzYWJsZVNlbmQoKQ0KICAgICAgICBzZW5kRW5hYmxlZCA9IGZhbHNlDQogICAgICAgIHByb3BlcnRpZXMuVGV4dCA9ICJbVFJdIFNlbmRpbmcgRGlzYWJsZWQiDQogICAgICAgIFN0YXJ0ZXJHdWk6U2V0Q29yZSgiQ2hhdE1ha2VTeXN0ZW1NZXNzYWdlIiwgcHJvcGVydGllcykNCiAgICBlbmQNCiAgICANCiAgICBsb2NhbCBDQmFyLCBDUmVtb3RlLCBDb25uZWN0ZWQgPSBMUFsnUGxheWVyR3VpJ106V2FpdEZvckNoaWxkKCdDaGF0JylbJ0ZyYW1lJ10uQ2hhdEJhclBhcmVudEZyYW1lWydGcmFtZSddLkJveEZyYW1lWydGcmFtZSddLkNoYXRCYXIsIGdhbWU6R2V0U2VydmljZSgnUmVwbGljYXRlZFN0b3JhZ2UnKS5EZWZhdWx0Q2hhdFN5c3RlbUNoYXRFdmVudHNbJ1NheU1lc3NhZ2VSZXF1ZXN0J10sIHt9DQogICAgDQogICAgbG9jYWwgSG9va0NoYXQgPSBmdW5jdGlvbihCYXIpDQogICAgICAgIGNvcm91dGluZS53cmFwKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgIGlmIG5vdCB0YWJsZS5maW5kKENvbm5lY3RlZCxCYXIpIHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCBDb25uZWN0ID0gQmFyWydGb2N1c0xvc3QnXTpDb25uZWN0KGZ1bmN0aW9uKEVudGVyKQ0KICAgICAgICAgICAgICAgICAgICBpZiBFbnRlciB+PSBmYWxzZSBhbmQgQmFyWydUZXh0J10gfj0gJycgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgTWVzc2FnZSA9IEJhclsnVGV4dCddDQogICAgICAgICAgICAgICAgICAgICAgICBCYXJbJ1RleHQnXSA9ICcnOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgTWVzc2FnZSA9PSAiPmQiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlU2VuZCgpDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgTWVzc2FnZTpzdWIoMSwxKSA9PSAiPiIgYW5kIG5vdCBNZXNzYWdlOmZpbmQoIiAiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0SVNPQ29kZShNZXNzYWdlOnN1YigyKSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kRW5hYmxlZCA9IHRydWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gTWVzc2FnZTpzdWIoMikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMuVGV4dCA9ICJbVFJdIEludmFsaWQgbGFuZ3VhZ2UiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0ZXJHdWk6U2V0Q29yZSgiQ2hhdE1ha2VTeXN0ZW1NZXNzYWdlIiwgcHJvcGVydGllcykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBzZW5kRW5hYmxlZCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9IHRyYW5zbGF0ZVRvKE1lc3NhZ2UsIHRhcmdldCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgX0cuU2VjdXJlQ2hhdCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgnUGxheWVycycpOkNoYXQoTWVzc2FnZSk7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENSZW1vdGU6RmlyZVNlcnZlcihNZXNzYWdlLCdBbGwnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5TZWN1cmVDaGF0IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCdQbGF5ZXJzJyk6Q2hhdChNZXNzYWdlKTsgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ1JlbW90ZTpGaXJlU2VydmVyKE1lc3NhZ2UsJ0FsbCcpDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgICAgIENvbm5lY3RlZFsjQ29ubmVjdGVkKzFdID0gQmFyOyBCYXJbJ0FuY2VzdHJ5Q2hhbmdlZCddOldhaXQoKTsgQ29ubmVjdDpEaXNjb25uZWN0KCkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQpKCkNCiAgICBlbmQNCiAgICANCiAgICBIb29rQ2hhdChDQmFyKTsgbG9jYWwgQmluZEhvb2sgPSBJbnN0YW5jZS5uZXcoJ0JpbmRhYmxlRXZlbnQnKQ0KICAgIA0KICAgIGxvY2FsIE1UID0gZ2V0cmF3bWV0YXRhYmxlKGdhbWUpOyBsb2NhbCBOQyA9IE1ULl9fbmFtZWNhbGw7IHNldHJlYWRvbmx5KE1ULCBmYWxzZSkNCiAgICANCiAgICBNVC5fX25hbWVjYWxsID0gbmV3Y2Nsb3N1cmUoZnVuY3Rpb24oLi4uKQ0KICAgICAgICBsb2NhbCBNZXRob2QsIEFyZ3MgPSBnZXRuYW1lY2FsbG1ldGhvZCgpLCB7Li4ufQ0KICAgICAgICBpZiByYXdlcXVhbCh0b3N0cmluZyhBcmdzWzFdKSwnQ2hhdEJhckZvY3VzQ2hhbmdlZCcpIGFuZCByYXdlcXVhbChBcmdzWzJdLHRydWUpIHRoZW4gDQogICAgICAgICAgICBpZiBMUFsnUGxheWVyR3VpJ106RmluZEZpcnN0Q2hpbGQoJ0NoYXQnKSB0aGVuDQogICAgICAgICAgICAgICAgQmluZEhvb2s6RmlyZSgpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIHJldHVybiBOQyguLi4pDQogICAgZW5kKQ0KICAgIA0KICAgIEJpbmRIb29rWydFdmVudCddOkNvbm5lY3QoZnVuY3Rpb24oKQ0KICAgICAgICBDQmFyID0gTFBbJ1BsYXllckd1aSddLkNoYXRbJ0ZyYW1lJ10uQ2hhdEJhclBhcmVudEZyYW1lWydGcmFtZSddLkJveEZyYW1lWydGcmFtZSddLkNoYXRCYXINCiAgICAgICAgSG9va0NoYXQoQ0JhcikNCiAgICBlbmQpDQplbmQpDQo=
